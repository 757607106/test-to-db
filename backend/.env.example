# ==========================================
# Chat-to-DB 后端环境配置模板
# ==========================================
# 复制此文件为 .env 并根据实际环境修改配置
# cp .env.example .env
# ==========================================

# ==========================================
# 统一服务主机配置（核心配置）
# ==========================================
# SERVICE_HOST 用于配置所有服务的默认主机地址
# 修改此值即可切换所有服务的访问地址
# 
# 示例：
# - localhost（默认，仅本机访问）
# - 192.168.13.163（局域网 IP 访问）
# - your-server.com（域名访问）
# 
# 注意：各服务配置可单独覆盖此默认值
# ==========================================
SERVICE_HOST=localhost

# ==========================================
# LangGraph API 配置
# ==========================================
# LANGGRAPH_API_URL 优先级高于 SERVICE_HOST
# 如不设置，将自动使用 http://${SERVICE_HOST}:2024
# ==========================================
# LANGGRAPH_API_URL=http://localhost:2024

# ==========================================
# PostgreSQL Checkpointer 配置
# ==========================================
# CHECKPOINT_POSTGRES_URI 优先级高于 SERVICE_HOST
# 如不设置，将自动使用 SERVICE_HOST 生成默认连接字符串
# ==========================================
# CHECKPOINT_POSTGRES_URI=postgresql://langgraph:langgraph_password_2026@localhost:5433/langgraph_checkpoints

# ==========================================
# MySQL 数据库配置
# ==========================================
# MYSQL_SERVER 优先级高于 SERVICE_HOST
# 如不设置，将使用 SERVICE_HOST 的值
# ==========================================
# MYSQL_SERVER=localhost
MYSQL_USER=root
MYSQL_PASSWORD=mysql
MYSQL_DB=chatdb
MYSQL_PORT=3306

# ==========================================
# Neo4j 图数据库配置
# ==========================================
# NEO4J_URI 优先级高于 SERVICE_HOST
# 如不设置，将自动使用 bolt://${SERVICE_HOST}:7687
# ==========================================
# NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=your_neo4j_password

# ==========================================
# Milvus 向量数据库配置
# ==========================================
# MILVUS_HOST 优先级高于 SERVICE_HOST
# 如不设置，将使用 SERVICE_HOST 的值
# ==========================================
# MILVUS_HOST=localhost
MILVUS_PORT=19530

# ==========================================
# LangSmith 监控配置
# ==========================================
# LangSmith 提供 LLM 应用的可观测性，包括：
# - 追踪所有 LLM 调用（输入、输出、延迟、Token 使用）
# - 追踪 LangGraph 工作流执行
# - 错误监控和调试
# - 性能分析和优化建议
#
# 获取 API Key: https://smith.langchain.com/
# ==========================================
LANGCHAIN_TRACING_V2=true
LANGCHAIN_ENDPOINT=https://api.smith.langchain.com
LANGCHAIN_API_KEY=your_langsmith_api_key
LANGCHAIN_PROJECT=chatbi-production
LANGCHAIN_CALLBACKS_BACKGROUND=true

# ==========================================
# LLM 配置（Fallback 机制）
# ==========================================
# 生产环境应通过「管理后台 > 模型配置」设置模型
# 以下配置仅在数据库未配置启用的模型时作为 fallback 使用
# 配置优先级：数据库模型配置 > 环境变量
# ==========================================
LLM_PROVIDER=deepseek
OPENAI_API_KEY=your_openai_api_key
OPENAI_API_BASE=https://api.deepseek.com/v1
LLM_MODEL=deepseek-chat

# ==========================================
# SQL 生成器模式配置
# ==========================================
# lite: 轻量版，1次LLM调用，响应更快
# react: 原版，3-4次LLM调用，更准确
# ==========================================
SQL_GENERATOR_MODE=lite

# ==========================================
# Ollama 本地模型配置
# ==========================================
# OLLAMA_BASE_URL 优先级高于 SERVICE_HOST
# 如不设置，将自动使用 http://${SERVICE_HOST}:11434
# ==========================================
# OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_EMBEDDING_MODEL=qwen3-embedding:0.6b
OLLAMA_REQUEST_TIMEOUT=60

# ==========================================
# 阿里云 DashScope 配置（云端 API）
# ==========================================
DASHSCOPE_API_KEY=your_dashscope_api_key
DASHSCOPE_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
DASHSCOPE_EMBEDDING_MODEL=text-embedding-v4

# ==========================================
# 向量服务通用配置
# ==========================================
VECTOR_SERVICE_TYPE=aliyun
VECTOR_DIMENSION=1024
VECTOR_CACHE_ENABLED=true
VECTOR_CACHE_TTL=3600
VECTOR_BATCH_SIZE=10
VECTOR_MAX_RETRIES=3
VECTOR_RETRY_DELAY=1

# ==========================================
# 混合检索配置
# ==========================================
HYBRID_RETRIEVAL_ENABLED=true
SEMANTIC_WEIGHT=0.35
STRUCTURAL_WEIGHT=0.35
PATTERN_WEIGHT=0.20
QUALITY_WEIGHT=0.10

# ==========================================
# 学习配置
# ==========================================
AUTO_LEARNING_ENABLED=true
FEEDBACK_LEARNING_ENABLED=true
PATTERN_DISCOVERY_ENABLED=true

# ==========================================
# 性能配置
# ==========================================
RETRIEVAL_CACHE_TTL=3600
MAX_EXAMPLES_PER_QUERY=5
PARALLEL_RETRIEVAL=true

# ==========================================
# LangGraph 优化图配置
# ==========================================
USE_OPTIMIZED_GRAPH=false
ENABLE_CHECKPOINTER=false

# ==========================================
# Skill 功能配置 (Phase 3 优化)
# ==========================================
# Skill 功能用于大型数据库（100+ 表）的领域隔离
# 对于中小型数据库（< 50 表），建议保持关闭以简化流程
# ==========================================
SKILL_MODE_ENABLED=false

# ==========================================
# 简化流程配置 (Phase 4 优化)
# ==========================================
SIMPLIFIED_FLOW_ENABLED=true
SKIP_CLARIFICATION_FOR_CLEAR_QUERIES=true

# ==========================================
# 缓存机制配置 (Phase 6 优化)
# ==========================================
# 缓存模式：simple（只用精确缓存，快速）| full（精确+语义缓存）
# ==========================================
CACHE_MODE=simple
THREAD_HISTORY_CACHE_ENABLED=true
EXACT_CACHE_TTL=3600

# ==========================================
# V2 架构配置
# ==========================================
V2_ENABLED=true
CHECKPOINT_MODE=none

# ==========================================
# 重构架构配置
# ==========================================
USE_REFACTORED_AGENTS=true
