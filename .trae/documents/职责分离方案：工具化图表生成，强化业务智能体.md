# 动态替换与能力注入方案 (v2)

基于您的需求（内置核心不可变、自定义专家可替换默认分析师），我们将实施以下方案。

## 1. 核心逻辑：替换与继承
当用户在会话中指定了 `Custom Agent`（如电商专家）时：
1.  **替换 (Replace)**: 系统默认的 `chart_generator_agent` (Data Analyst) 将被从工作流中**移除**，不再参与该次会话。
2.  **继承 (Inherit)**: 系统将自动提取默认分析师拥有的 **图表生成工具 (Chart Tools)**，并将其**注入**到用户的 `Custom Agent` 中。
3.  **执行**: `Custom Agent` 将使用用户配置的 Prompt (行业知识) + 注入的工具 (画图能力) 来完成分析任务。

## 2. 修改清单

### A. 后端 Supervisor 逻辑重构
*   **文件**: `backend/app/agents/agents/supervisor_agent.py`
*   **逻辑变更**:
    *   在 `_create_worker_agents` 中增加逻辑判断。
    *   **IF** `active_agent_profiles` is not empty:
        *   不加载 `chart_generator_agent`。
        *   加载 `active_agent_profiles` 中的 Agent。
        *   **关键**: 获取 `chart_generator_agent.tools` 并 append 到这些 Custom Agents 的 `tools` 列表中。
    *   **ELSE**:
        *   加载默认的 `chart_generator_agent`。

### B. 系统配置调整
*   **文件**: `backend/app/core/agent_config.py`
*   **变更**: 恢复/保持 `CORE_AGENT_CHART_ANALYST` 的命名（代表默认数据分析师），不降级为纯工具。

### C. Admin 前端微调
*   **文件**: `frontend/admin/src/pages/LLMConfig/index.tsx`
*   **变更**: 确保三大核心 Agent 的描述准确反映其“默认内置”的地位。

## 实施步骤
1.  修改 `supervisor_agent.py` 实现工具注入和 Agent 替换逻辑。
2.  更新 `agent_config.py` 确保命名一致。
3.  (可选) 检查 `router_agent.py` 确保路由逻辑适配。

请确认执行。