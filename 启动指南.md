# Chat-to-DB 启动指南

## 1. 启动 Docker 容器

### 启动所有必需的容器
```bash
# 启动所有数据库相关容器
docker start milvus-etcd milvus-minio milvus-standalone chatdb_mysql chatdb_neo4j universal-bi-postgres universal-bi-redis
```

### 验证容器状态
```bash
# 查看所有容器状态
docker ps

# 应该看到以下容器都在运行 (STATUS 显示 Up):
# - milvus-standalone (向量数据库)
# - milvus-minio (Milvus 存储)
# - milvus-etcd (Milvus 配置)
# - chatdb_mysql (MySQL 数据库)
# - chatdb_neo4j (Neo4j 图数据库)
# - universal-bi-postgres (PostgreSQL)
# - universal-bi-redis (Redis)
```

### 设置容器开机自动启动 (可选)
```bash
docker update --restart=always milvus-etcd milvus-minio milvus-standalone chatdb_mysql chatdb_neo4j universal-bi-postgres universal-bi-redis
```

## 2. 启动后端服务

### 进入项目目录
```bash
cd /Users/pusonglin/chat-to-db
```

### 激活虚拟环境
```bash
source .venv/bin/activate
```

### 启动管理后端 (Admin Server)
```bash
cd backend
python admin_server.py
```
- 默认端口: `8000`
- 访问地址: http://localhost:8000

### 启动对话后端 (Chat Server) - 另开终端
```bash
cd backend
python chat_server.py
```
- 默认端口: `8001`
- 访问地址: http://localhost:8001

## 3. 启动前端服务

### 启动管理前端 (Admin)
```bash
cd frontend/admin
yarn install  # 首次运行需要安装依赖
yarn start
```
- 默认端口: `3000`
- 访问地址: http://localhost:3000

### 启动对话前端 (Chat) - 另开终端
```bash
cd frontend/chat
npm install  # 首次运行需要安装依赖
npm run dev
```
- 默认端口: `3001`
- 访问地址: http://localhost:3001

## 4. 验证系统状态

### 检查服务健康状态
```bash
# 检查 Admin API
curl http://localhost:8000/api/health

# 检查 Chat API
curl http://localhost:8001/health
```

### 检查数据库连接
- 访问管理前端: http://localhost:3000
- 进入 "连接管理" 页面
- 应该能看到已配置的数据库连接列表

## 5. 常见问题排查

### Docker 容器无法启动
```bash
# 查看容器日志
docker logs milvus-standalone
docker logs chatdb_mysql
docker logs chatdb_neo4j

# 如果端口被占用，查找占用进程
lsof -i :3306  # MySQL
lsof -i :7687  # Neo4j
lsof -i :19530 # Milvus
```

### 后端无法连接数据库
```bash
# 检查环境变量配置
cat backend/app/core/config.py

# 测试 MySQL 连接
docker exec -it chatdb_mysql mysql -uroot -pmysql -e "SELECT 1"

# 测试 Neo4j 连接
docker exec -it chatdb_neo4j cypher-shell -u neo4j -p 65132090 "RETURN 1"
```

### 前端无法访问后端
- 检查后端服务是否正常运行
- 检查 CORS 配置
- 查看浏览器控制台错误信息

## 6. 完整启动脚本

创建一个启动脚本 `start-all.sh`:
```bash
#!/bin/bash

echo "=== 启动 Docker 容器 ==="
docker start milvus-etcd milvus-minio milvus-standalone chatdb_mysql chatdb_neo4j universal-bi-postgres universal-bi-redis

echo "=== 等待容器启动完成 ==="
sleep 10

echo "=== 验证容器状态 ==="
docker ps

echo ""
echo "Docker 容器已启动!"
echo "请手动启动以下服务:"
echo "1. 后端服务: cd backend && python admin_server.py"
echo "2. 对话服务: cd backend && python chat_server.py"
echo "3. 管理前端: cd frontend/admin && yarn start"
echo "4. 对话前端: cd frontend/chat && npm run dev"
```

使用方法:
```bash
chmod +x start-all.sh
./start-all.sh
```

## 7. 停止服务

### 停止 Docker 容器
```bash
docker stop milvus-standalone milvus-minio milvus-etcd chatdb_mysql chatdb_neo4j universal-bi-postgres universal-bi-redis
```

### 停止后端和前端
在各个终端中按 `Ctrl+C` 停止服务

---

**提示**: 建议按照以上顺序启动服务，确保依赖的服务先启动完成。
